/*
 * Switch.c
 *
 *  Created on: Aug 17, 2024
 *      Author: king
 */
#include "Switch.h"

uint16_t CCR2 = 0;
uint16_t Temp = 0;
TIM_HandleTypeDef htim;

void Fan_Init(TIM_HandleTypeDef* htim2)
{
	htim = *htim2;
	HAL_TIM_PWM_Start(htim2, TIM_CHANNEL_2);
}

void Fan_Fast(TIM_HandleTypeDef* htim2, uint16_t Fan_Pin)
{
	if (!HAL_GPIO_ReadPin(GPIOA, Fan_Pin))
	{
		HAL_Delay(100);
		while (!HAL_GPIO_ReadPin(GPIOA, Fan_Pin));
		CCR2 = __HAL_TIM_GET_COMPARE(htim2, TIM_CHANNEL_2);
		Temp = CCR2 + 100;
		if (Temp <= 500)
		{
			__HAL_TIM_SET_COMPARE(htim2, TIM_CHANNEL_2, CCR2);
		}
		HAL_Delay(100);
	}
}

void Fan_Slow(TIM_HandleTypeDef* htim2, uint16_t Fan_Pin)
{
	if (!HAL_GPIO_ReadPin(GPIOA, Fan_Pin))
	{
		HAL_Delay(100);
		while (!HAL_GPIO_ReadPin(GPIOA, Fan_Pin));
		CCR2 = __HAL_TIM_GET_COMPARE(htim2, TIM_CHANNEL_2);
		Temp = CCR2 - 100;
		if (Temp >= 1)
		{
			__HAL_TIM_SET_COMPARE(htim2, TIM_CHANNEL_2, CCR2);
		}
		HAL_Delay(100);
	}
}
