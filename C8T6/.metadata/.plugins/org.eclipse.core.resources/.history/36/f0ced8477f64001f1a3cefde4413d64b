/*
 * INA219.c
 *
 *  Created on: Aug 26, 2024
 *      Author: king
 */
#include "I2C/INA219.h"

uint16_t ina219_calibrationValue;
uint16_t ina219_currentDivider_mA;

uint16_t INA219_ReadDataForRegister_16Bits(uint8_t RegAddress)
{
	uint16_t Data;

	I2C_Start();
	I2C_SendByte(W_Address);
	I2C_ReceiveAck();
	I2C_SendByte(RegAddress);
	I2C_ReceiveAck();

	I2C_Start();
	I2C_SendByte(R_Address);
	I2C_ReceiveAck();
	Data = I2C_ReceiveByte()&0xFF;
	I2C_SendAck(1);
	Data = I2C_ReceiveByte()<<8;
	I2C_SendAck(1);
	I2C_End();

	return Data;
}

void INA219_WriteDataForRegister_16Bits(uint8_t RegAddress, uint16_t Data)
{
	I2C_Start();
	I2C_SendByte(W_Address);
	I2C_ReceiveAck();
	I2C_SendByte(Data>>8);
	I2C_ReceiveAck();
	I2C_SendByte((uint8_t)Data);
	I2C_ReceiveAck();
	I2C_End();
}

void INA219_Init(void)
{
	uint16_t configInfo = INA219_CONFIG_VOLTAGE_RANGE_16V |
	                    INA219_CONFIG_GAIN_2_80MV | INA219_CONFIG_BADCRES_12BIT |
	                    INA219_CONFIG_SADCRES_12BIT_1S_532US |
	                    INA219_CONFIG_MODE_SANDBVOLT_CONTINUOUS;
	————————————————

	                            版权声明：本文为博主原创文章，遵循 CC 4.0 BY-SA 版权协议，转载请附上原文出处链接和本声明。

	原文链接：https://blog.csdn.net/weixin_48991062/article/details/134292801


	//Current_LSB = (80/10)/2^15 = 0.0002
	//cal = 0.04096/(0.0002A*0.01r) = 20480 = 0x5000
	ina219_calibrationValue = 20480;
	INA219_WriteDataForRegister_16Bits(INA219_REG_CALIBRATION, ina219_calibrationValue);

}
